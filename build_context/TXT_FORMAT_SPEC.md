# TXT Snapshot Format Specification

## Overview

The TXT snapshot is a **single UTF-8 text file** generated by PowerShell.
It represents a complete, ordered snapshot of a repository.

The file is designed to be:
- Human-readable
- Machine-parseable
- Deterministic
- Self-contained

---

## Global Rules

- Sections appear in a fixed order
- Each section is clearly delimited
- No section is optional
- No data exists outside a section
- File contents are embedded verbatim, except for non-ASCII files which are summarized (see FILE_CONTENTS)

---

## Section Delimiter Format

Each section begins with a delimiter line:

===== SECTION: <SECTION_NAME> =====

The section name is uppercase and exact.

---

## Section Order and Meaning

### 1. REPO_ROOT

Contents:
- A single line containing the absolute path of the repository root at export time

Purpose:
- Informational only
- Used for traceability, not filesystem access

---

### 2. FILE_STRUCTURE

Contents:
- One repo-relative file path per line
- Paths use forward or backward slashes as emitted by PowerShell

Purpose:
- Represent the complete file tree
- Preserve ordering and presence information

---

### 3. LANGUAGES

Contents:
- One language name per line
- Derived from file extensions only

Purpose:
- Inform which AST parsers may be required
- No guarantee of parser availability

---

### 4. REQUIRED_TOOLS

Contents:
- One tool name per line
- Best-effort inference based on files present

Examples:
- Python
- NodeJS
- PowerShell

Purpose:
- Inform build and analysis expectations
- Not authoritative dependency resolution

---

### 5. REQUIRED_DEPENDENCIES

Contents:
- One dependency name per line
- Best-effort inference based on files present

Examples:
- pip
- npm
- poetry

Purpose:
- Inform environment expectations
- Not a lockfile or resolver

---

### 6. FILE_CONTENTS

Contents:
- All repository files, embedded inline

Each file begins with a delimiter:

----- FILE: <repo-relative-path> -----

The lines following are the exact contents of that file until the next FILE delimiter or EOF.

Exception (non-ASCII files):
- If a file contains any non-ASCII byte, its content is not embedded.
- Instead, the file body is replaced with:
  - [CONTENT OMITTED: NON-ASCII]
  - TYPE_GUESS: <best-effort description based on extension>
  - SIZE_BYTES: <file size in bytes>

Purpose:
- Provide all source text for AST parsing
- Eliminate filesystem access during analysis

---

## Parsing Expectations

A consumer of this file should:

1. Read sequentially
2. Detect section boundaries
3. Store section data
4. In FILE_CONTENTS:
   - Detect file delimiters
   - Capture file path
   - Capture file body verbatim

No section implies semantics.
All semantics are derived later via AST parsing.

---

## Error Handling Expectations

If:
- A section is missing
- Section order is violated
- A FILE delimiter is malformed

The consumer should:
- Stop processing
- Report the exact structural error
- Not guess or auto-correct

---

## Non-Goals

This format does NOT:
- Encode AST data
- Encode execution order
- Encode dependency resolution
- Encode runtime behavior

It is a snapshot, not an analysis.
